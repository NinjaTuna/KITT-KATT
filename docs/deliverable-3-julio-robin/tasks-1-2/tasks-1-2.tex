%!TEX program = xelatex

\documentclass[11pt,titlepage]{report}
\input{../../library/import}
\input{../../library/style}
\addbibresource{../../library/bibliography.bib}

\begin{document}

\chapter{System model for driving on a straight line}
\section{Task 1}
State equations for KITT are given by:

\begin{align} \label{eq:task1-state-eq}
    m\dot{x}_2 = m\ddot{x}_1 &= -\rho \dot{x_{1}} + \tau \\
    y &= x_1
\end{align}

Where $x_n$ denote the components of the state vector $\vec{x}$, being velocity ($x_1$) and acceleration ($x_2$), $\rho$ is the friction coefficient and $\tau$ the  force generated by KITT's wheels. $y$ is the system's output. Writing these in the required form

\begin{align*}
    \dot{\vec{x}} &= \mathbf{A}\vec{x} + \mathbf{B}u \\
    \vec{y} &= \mathbf{C}\vec{x},
\end{align*}

yields:

\begin{align}\label{eq:task1-system}
    \begin{bmatrix}
        \dot{x}_1 \\ 
        \dot{x}_2
    \end{bmatrix} &= 
    \begin{bmatrix}
        0 & 1 \\
        0 & \frac{-\rho}{m}
    \end{bmatrix}
    \begin{bmatrix}
        x_1 \\ 
        x_2
    \end{bmatrix} +
    \begin{bmatrix}
        0 \\ 
        \frac{1}{m}
    \end{bmatrix}
    u
    \\
    y &= 
    \begin{bmatrix}
        1 & 0
    \end{bmatrix}
    \begin{bmatrix}
        x_1 \\ 
        x_2
    \end{bmatrix}.
\end{align}

We immediately notice this system is one of the second order, since it has two state variables. Deriving the characteristic equation $\mathrm{det}\{\mathbf{A} - \lambda\mathbf{I}\} = 0$ yields:

\begin{equation}
    \lambda(\frac{\rho}{m} + \lambda) = 0,
\end{equation}

so we obtain the eigenvalues:

\begin{equation}
    \lambda_1 = 0 \quad\quad \lambda_2 = -\frac{\rho}{m}.
\end{equation}

This renders the system either asymptotically stable, or unstable. Common sense dictates that the system is stable: KITT will not drive of by its own, but we can prove it by deriving the system's eigenvectors:

\begin{equation}
    \vec{e}_1 =
        \begin{bmatrix}
            1 \\
            0
        \end{bmatrix}
    \quad\quad
    \vec{e}_2 =
        \begin{bmatrix}
            -\frac{\rho}{m} \\
            1
        \end{bmatrix}.
\end{equation}

We can see by inspection that these vectors are independent, so the system is asymptotically stable. To determine controllability, we derive the controllability matrix:

\begin{equation}
    \mathcal{C} = 
    \begin{bmatrix}
        \mathbf{B} & \mathbf{AB}
    \end{bmatrix} =
    \begin{bmatrix}
        0 & \frac{1}{m} \\
        \frac{1}{m} & -\frac{\rho}{m} \\
    \end{bmatrix}.
\end{equation}

It is easily observed that $\mathrm{rank}(\mathcal{C}) = 2$. Combining this with the fact that $\mathbf{A}$ is a 2x2-matrix, yields that the system is controllable. For observability we can perform similar steps, deriving the observability matrix:

\begin{equation}
    \mathcal{O} = 
    \begin{bmatrix}
      \mathbf{C} \\
      \mathbf{CA}
    \end{bmatrix} = 
    \begin{bmatrix}
        1 & 0 \\
        0 & 1 \\
        0 & -\frac{1}{m}
    \end{bmatrix},
\end{equation}

for which holds that $\mathrm{rank}(\mathcal{O}) = 2$ as well, meaning the system is observable too.

\section{Task 2}
The previous equations do not give an equation for determining $\tau$, we will now derive a set of expressions, which we can use to complete the model. Using the given properties we can write the following for $\tau$:

\begin{equation}\label{eq-task2-tau}
    \tau = k_w k_g k_t i,
\end{equation}

where $k_w$ is a constant relating torque on the wheels to force, $k_g$ is the gear ratio, $k_t$ a constant that relates motor current to motor torque and $i$ the motor current. We can argue that $k_w$ must be equal to $\frac{1}{r_w}$, where $r_w$ is the wheel radius. Relating the forward velocity $\dot{x}_1$ to the velocity of the motor, we can write:

\begin{equation}\label{eq-task2-e}
    e = k_t \omega_w = \frac{\dot{x}_1}{k_g r_w},
\end{equation}

where $\omega_w$ denotes the angular velocity of KITT's wheels. Combining Equations~\ref{eq-task2-tau} and \ref{eq-task2-e} yields the following expression for $\tau$:

\begin{equation}  
    \tau = \frac{k_w k_g k_t i}{R}.
\end{equation}

In this equation we had to introduce a new state $i = x_3$, witch renders the system one of the third order. To complete the model we need to derive an expression for $\dot{x}_3 = \frac{di}{dt}$ from the voltage balance of our system:

\begin{equation}\label{eq-task2-didt}
    \frac{di}{dt} = \frac{v-iR-\frac{\dot{x}_1}{k_g r_w}}{R}.
\end{equation}

We can now write the total system in matrix-form, by setting the control input $u$ to be equal to $v$:

\begin{equation}
    \begin{bmatrix}
        \dot{x}_1 \\ 
        \dot{x}_2 \\
        \dot{x}_3
    \end{bmatrix} = 
    \begin{bmatrix}
        0 & 1 & 0 \\
        0 & \frac{-\rho}{m} & \frac{k_{t}k_{g}}{r_{w}m} \\
        0 & \frac{-k_{t}}{k_{g} r_{w} L} & -\frac{R}{L}
    \end{bmatrix}
    \begin{bmatrix}
        x_1 \\
        x_2 \\
        x_3
    \end{bmatrix} + 
    \begin{bmatrix}
        0 \\ 
        0 \\
        \frac{1}{L}
    \end{bmatrix}v.
\end{equation}

When setting $L$ to be equal to zero, we can eliminate the third state, so the system simplifies to its final form:

\begin{equation}
    \begin{bmatrix}
        \dot{x}_1 \\ 
        \dot{x}_2
    \end{bmatrix} = 
    \begin{bmatrix}
        0 & 1 \\
        0 & -\frac{\rho}{m} - \frac{k_t^2}{r_w^2m}
    \end{bmatrix}
    \begin{bmatrix}
        x_1 \\ 
        x_2
    \end{bmatrix} +
    \begin{bmatrix}
        0 \\ 
        \frac{k_g k_t}{R r_w m}
    \end{bmatrix}v.
\end{equation}

Since the form of this system is no different from the one in Equation~\ref{eq:task1-system}, we can draw the same conclusions regarding its stability, controllability and observability, being that it is stable, controllable and observable.
\end{document}