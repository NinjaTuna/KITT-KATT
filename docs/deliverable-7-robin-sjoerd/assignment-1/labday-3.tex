%!TEX program = xelatex

\documentclass[11pt,titlepage]{report}
\input{../../library/import}
\input{../../library/style}
\addbibresource{../../library/bibliography.bib}

\begin{document}

\section{Labday 3}
\subsection{Report 11}
For testing audio transmission, we tried to transmit some signals to see what the frequency spectrum of the received signal would be. Plots of the resulting spectra are given in Figure~\ref{fig:rep11-test-spectra}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-11-random-signals.pdf}
	\caption{Some arbitrary signal spectra, measured in the testing environment}
	\label{fig:rep11-test-spectra}
\end{figure}

We obtained mostly expected results: a sine wave sent and received with sufficient sampling rates yields delta-pulses on its positive and negative frequency and a sine wave sampled with $F_s < 2B$ results in an aliased spectrum. It is worth noting the fact that there is not much of a difference in the spectrum of the pulsed signal, compared to that of a sine. This could be explained by speaker characteristics (a square wave requires infinite acceleration of the speaker's conus, which is not possible), as well as numerical effects due to the use of a computer system.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-11-time.pdf}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-11.pdf}
	\end{subfigure}
	\caption{The required impulse responses and spectra}
	\label{fig:rep11-impulse-spectra}
\end{figure}

The required impulse responses and spectra are shown in Figure~\ref{fig:rep11-impulse-spectra}. For equal $F_s$ of \SI{22050}{Hz}, we of course do not expect aliasing to occur. However, for $F_{s,TX} = \SI{22050}{Hz}$ and $F_{s,TX} = \SI{8000}{Hz}$, we are clearly undersampling the received analog signal, so aliasing is to be expected. Lastly, for $F_{s,TX} = \SI{4000}{Hz}$ and $F_{s,TX} = \SI{22050}{Hz}$, we are oversampling, so aliasing is not to be expected, but the highest frequency should be $\pm \frac{F_{s,TX}}{2} = \pm \SI{2}{kHz}$, which corresponds nicely to our measured spectrum, considering the effects of noise.

%% TODO: Answer last question and check the above

\subsection{Report 12 and 13}
Assuming the speed of sound to be \SI{340}{m/s}, it will take $0.01/340 = \SI{29.4}{\micro s}$ to travel a distance of \SI{1}{cm}. If we would want to measure with a resolution of \SI{1}{cm}, we would need to be able to measure a time difference of arrival of half this timespan, which means a receiver capable of a sampling rate $F_s > (29.4 \times 10^{-6} / 2)^{-1} = \SI{68}{kHz}$.

%% FIGURE subfig:rep12-time + subfig:rep12-delays IN fig:rep12-los HERE %%
\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-13-time.pdf}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-13-delays.pdf}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-13-time-set-2.pdf}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-13-delays-set-2.pdf}
	\end{subfigure}
	\caption{Time plots and calculated delays of the received signal, for two different measurements (top and bottom)}
	\label{fig:rep12-los}
\end{figure}

Figure~\ref{fig:rep12-los} shows time plots of the received signal after transmitting a single impulse over various distances, as well as a diagram that shows the measured delays per distance, along with an least-squares approximation and expected value line, in two measurements. Looking at the measured delays, we see that they are not all consistent with our expectations. This is most likely due to delays introduced in the processing of the received signal. When we compare the amplitudes of the various signals, we see that they indeed drop over distance, which is according to our expectations. % TODO: edit to describe two data sets

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{../../deliverable-7-resources/figures/ass-1/report-11-12-13/ass-1-report-13-los-nlos.pdf}
	\caption{Time plots of received signals with and without line-of-sight}
	\label{fig:rep13-nlos}
\end{figure}

Repeating the previous experiment with an obstacle (a \SI{15}{"} Macbook) between the transmitter and receiver, we obtained the results as depicted in Figure~\ref{fig:rep13-nlos}. The measurements at \SI{50}{cm} show results that are to be expected, the NLOS signal was received later and with a lesser amplitude than the LOS signal. For \SI{100}{cm}, our results were less than ideal, since it looks like the NLOS signal was actually received after less time than the LOS signal, which is not conform our expectations. Once again this is probably because of processiong delays in the receiver. The amplitude of the NLOS signal was indeed lower than that of the LOS signal, though.

%% TODO check the above

\subsection{Task before report 14}
The parameters of \texttt{refsignal.m} are as follows:
Ncodebits: 
Timer0: All 3 timers are indexes to a vector of frequencies. Timer0 determines the modulation frequency f0
Timer1: used to compute Np = Fs/f1. Np is number of samples in one Timer1 period
Timer3: Nx=round(Fs/f3) = number of samples in template vector (integer)
code: hex string which is converted to binary and sent over the line
Fs: sample frequency

Maximum modulation frequency f0 = 30e3Hz. Dat kun je zien in refsignal.m op regel 25.



\subsection{Report 14}
Apply channel estimation algorithm of labday 2

\subsection{Report 15}
Design optimal parameters of audio beacon

\end{document}